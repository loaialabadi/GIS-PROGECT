<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø´Ù‡Ø§Ø¯Ø© ØªØªØ¨Ø¹ Ø²Ù…Ù†ÙŠ Ù„Ù…Ù†Ø´Ø£</title>
    <style>
        body { font-family: 'Arial', sans-serif; background: #eee; margin: 0; padding: 20px; }
        .container { display: flex; max-width: 1200px; margin: auto; background: #fff; border: 2px solid black; padding: 15px; box-sizing: border-box; }
        .right-column { flex: 1; border-left: 2px solid black; padding-left: 15px; display: flex; flex-direction: column; }
        .logos { display: flex; justify-content: space-between; gap: 40px; margin-bottom: 20px; }
        .logo-box { text-align: center; }
        .logo-title { font-weight: bold; margin-top: 5px; font-size: 14px; }
        .logo { width: 60px; height: 60px; object-fit: contain; border: 1px solid black; }
        table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
        table, th, td { border: 1px solid black; }
        td { padding: 6px; font-size: 14px; }
        .left-columns { flex: 2; display: flex; flex-direction: column; padding-right: 15px; }
        .certificate-title { font-size: 24px; font-weight: bold; text-align: center; background: #fde5a6; padding: 12px; border: 1px solid black; margin-bottom: 35px; }
        .photos-container { display: grid; grid-template-columns: repeat(2, 1fr); grid-gap: 15px; margin-bottom: 15px; height: 800px; }
        .photo-box { height: 390px; border: 2px dashed #aaa; border-radius: 8px; background: #f9f9f9; display: flex; justify-content: center; align-items: center; color: #888; font-size: 14px; cursor: pointer; overflow: hidden; position: relative; }
        .photo-label { position: absolute; top: -25px; left: 50%; transform: translateX(-50%); background-color: rgba(0, 0, 0, 0.7); color: white; padding: 3px 10px; border-radius: 5px; font-weight: bold; white-space: nowrap; z-index: 10; pointer-events: none; }
        .photo-box img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .footer-text { max-width: 1200px; margin: 50px auto 0; font-size: 13px; text-align: center; border-top: 1px solid black; padding-top: 10px; color: #555; line-height: 1.3; }
        @media print {
            body { background: white; margin: 0; padding: 0; }
            #printBtn, #saveBtn { display: none !important; }
            @page { size: A3 landscape; margin: 1cm; }
            html, body { width: auto; height: auto; }
            .container { box-shadow: none !important; border: none !important; padding: 0 !important; margin: 0 auto !important; max-width: 100%; }
        }
    </style>
</head>
<body>
    <button onclick="printCertificate()" id="printBtn" style="position: fixed; top: 20px; left: 20px; z-index: 9999; padding: 10px 20px; background-color: #0d6efd; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px;">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</button>
    <button onclick="saveCertificate()" id="saveBtn" style="position: fixed; top: 20px; left: 180px; z-index: 9999; padding: 10px 20px; background-color: #198754; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px;">ğŸ’¾ Ø­ÙØ¸ ÙƒØµÙˆØ±Ø©</button>

    <div class="container">
        <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠÙ…Ù† -->
        <div class="right-column">
            <!-- Ø§Ù„Ù„ÙˆØ¬ÙˆÙ‡Ø§Øª -->
            <div class="logos">
                <div class="logo-box">
                    <img src="{{ asset('images/logo2.png') }}" class="logo" alt="Logo 2">
                    <div class="logo-title">Ø¯ÙŠÙˆØ§Ù† Ø¹Ø§Ù… Ù…Ø­Ø§ÙØ¸Ø© Ù‚Ù†Ø§</div>
                </div>
                <div class="logo-box">
                    <img src="{{ asset('images/logo1.png') }}" class="logo" alt="Logo 1">
                    <div class="logo-title">Ù…Ø±ÙƒØ² Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø´Ø¨ÙƒØ§Øª Ø§Ù„Ù…Ø±Ø§ÙÙ‚ Ø¨Ù‚Ù†Ø§</div>
                </div>
            </div>

            <!-- Ø¬Ø¯ÙˆÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
            <table>
                <tr><td>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</td><td>{{ $data->client_name }}</td></tr>
                <tr><td>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</td><td>{{ $data->national_id }}</td></tr>
                <tr><td>Ø§Ù„Ù…Ø±ÙƒØ²</td><td>{{ $data->center_name }}</td></tr>
                <tr><td>Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</td><td>{{ $data->transaction_number }}</td></tr>
                <tr><td>Ø§Ù„ØºØ±Ø¶</td><td>{{ $data->purpose }}</td></tr>
                <tr><td>Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠ</td><td>{{ $data->coordinates }}</td></tr>
            </table>

            <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØªØ¨Ø¹ -->
            <h5>Ø­Ø§Ù„Ø© Ø§Ù„ØªØªØ¨Ø¹</h5>
@if(!empty($trackingStatus) && count($trackingStatus) > 0)
    <h5>Ø­Ø§Ù„Ø© Ø§Ù„ØªØªØ¨Ø¹</h5>
    <table border="1" cellspacing="0" cellpadding="10" style="border-collapse: collapse; width: 100%; text-align: center; font-size: 14px;">
        <tr>
            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            <th>Ø§Ù„ÙˆØµÙ</th>
        </tr>
        @foreach($trackingStatus as $date => $status)
            @if(!empty($date) || !empty($status))
                <tr>
                    <td>{{ $date }}</td>
                    <td>{{ $status }}</td>
                </tr>
            @endif
        @endforeach
    </table>
@endif
        </div>

        <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠØ³Ø± -->
        <div class="left-columns">
            <div class="certificate-title">ğŸ“„ Ø´Ù‡Ø§Ø¯Ø© ØªØªØ¨Ø¹ Ø²Ù…Ù†ÙŠ Ù„Ù…Ù†Ø´Ø£</div>
            <div class="photos-container">
                @foreach($trackingStatus as $date => $status)
                    @if(!empty($date) && !empty($status))
                        <div class="photo-box" ondrop="drop(event, this)" ondragover="allowDrop(event)">
                            <div class="photo-label">ØµÙˆØ±Ø© Ø¨ØªØ§Ø±ÙŠØ® {{ $date }}</div>
                            ğŸ“· Ø§Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§
                        </div>
                    @endif
                @endforeach
            </div>
        </div>
    </div>

    <div class="footer-text">
        ØªÙ… Ø§Ù„Ø¥Ø±Ø´Ø§Ø¯ Ø¹Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù…Ø¹Ø±ÙØ© Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨ ÙˆØ°Ù„Ùƒ Ø¯ÙˆÙ† Ø£Ø¯Ù†Ù‰ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø¹Ù„Ù‰ Ù…Ø±ÙƒØ² Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø´Ø¨ÙƒØ§Øª Ø§Ù„Ù…Ø±Ø§ÙÙ‚ Ø¨Ù‚Ù†Ø§ - Ù„Ø§ ÙŠØ¹ØªØ¯ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¨ÙŠØ§Ù† ÙƒÙ…Ø³ØªÙ†Ø¯ Ù…Ù„ÙƒÙŠØ© - Ù„Ø§ ÙŠØ³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„Ø¨ÙŠØ§Ù† Ø¥Ù„Ø§ ÙÙŠ Ø§Ù„ØºØ±Ø¶ Ø§Ù„Ù…Ø­Ø±Ø± Ù…Ù† Ø£Ø¬Ù„Ù‡.
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        function printCertificate() {
            document.getElementById('printBtn').style.display = 'none';
            document.getElementById('saveBtn').style.display = 'none';
            window.print();
            setTimeout(() => {
                document.getElementById('printBtn').style.display = 'block';
                document.getElementById('saveBtn').style.display = 'block';
            }, 1000);
        }

        function saveCertificate() {
            let container = document.querySelector('.container');
            html2canvas(container, { scale: 2 }).then(canvas => {
                let link = document.createElement("a");
                link.download = "certificate.png";
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        function allowDrop(ev) { ev.preventDefault(); }
        function drop(ev, element) {
            ev.preventDefault();
            const file = ev.dataTransfer.files[0];
            if (file && file.type.startsWith("image/")) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    element.innerHTML = '<div class="photo-label">' + element.querySelector(".photo-label").innerText + '</div><img src="' + e.target.result + '" alt="ØµÙˆØ±Ø©">';
                }
                reader.readAsDataURL(file);
            } else {
                alert("ÙŠØ±Ø¬Ù‰ Ø³Ø­Ø¨ ØµÙˆØ±Ø© ÙÙ‚Ø·");
            }
        }
    </script>
</body>
</html>
